<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯Šè¾…ç³»ç»Ÿ-åå°ç®¡ç†</title>
    <link rel="stylesheet" href="/js/bootstrap/bootstrap-v4.3.1.min.css">
    <link rel="stylesheet" href="/css/admin.css">
</head>

<body>
<nav class="navbar navbar-light" style="background-color: #3498db;">
    <a class="navbar-brand" href="#">è¯Šè¾…ç³»ç»Ÿ-åå°ç®¡ç†</a>
    <div class="collapse navbar-collapse" id="navbarNav" style="float: right">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Features</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Pricing</a>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
        </li>
      </ul>
    </div>
    <div class="form-inline my-2 my-lg-0" id="userBox" style="margin-right: 2rem">
        <ul>
            <li class="dropdown  nav-item">
                <a class="nav-link" id="header-userDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="glyphicon glyphicon-user adminName">
                             <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading...
                        </span>
                    <span class="caret"></span>
                </a>
                <div class="dropdown-menu" aria-labelledby="userDropdown">
                    <a class="dropdown-item" id="admin-loginOut" href="javascript:;">é€€å‡º</a>
                </div>
            </li>
            <li><a class="nav-link">ä½¿ç”¨è¯´æ˜</a></li>
        </ul>
    </div>
</nav>
<div class="row" id="top-show-box">
        <div class="col-md-6">
            <div class=" border jumbotron show-box row " id="number-show-box">
                <div class="col-md-7">
                    <div class="title">
                        <h2>è¿‡å»7å¤©è¯¾ç¨‹å‘å¸ƒæƒ…å†µ</h2>
                    </div>
                    <hr class="my-4">
                    <div class="content" id="courses-show-box-container">
                    </div>
                </div>
                <div class="col-md-5">
                    <div id="show-pie-chart"
                         style="height: 330px;width: 100%;  text-align: center;"></div>
                </div>
            </div>

        </div>
        <div class="col-md-6">
            <div class=" border jumbotron show-box row " id="future-box">
                <div class="col-md-7">
                    <div class="title">
                        <h2>æœªæ¥ä¸€ä¸ªæœˆè¯¾ç¨‹å‘å¸ƒæƒ…å†µ</h2>
                    </div>
                    <hr class="my-4">
                    <div class="content" >
                    </div>
                </div>
                <div class="col-md-5">
                    <div id="show--chart"
                         style="height: 330px;width: 100%;  text-align: center;"></div>
                </div>
            </div>

        </div>
</div>
<div class="container border jumbotron show-box" id="show-data-box">
    <div class="title">
        <h2>è¿‡å»ä¸€ä¸ªæœˆè¯¾ç¨‹å‘å¸ƒæƒ…å†µ</h2>
    </div>
    <hr class="my-4">
    <div class="content" id="show-data-content" style="width: 100%;height:400px;">
    </div>
</div>
<div class="container border jumbotron show-box" id="input-user-msg">
    <div class="title">
        <h2>ç”¨æˆ·ä¿¡æ¯å¯¼å…¥</h2>
    </div>
    <hr class="my-4">
    <div class="row" id="input-select-box">
        <div class="col-md-6">
            <a class="btn btn-primary" id="input-once">æ‰‹åŠ¨å¯¼å…¥å•ä¸ªç”¨æˆ·</a>
        </div>
        <div class="col-md-6">
            <a class="btn btn-primary" id="input-batch">æ‰¹é‡å¯¼å…¥å¤šä¸ªç”¨æˆ·</a>
        </div>
    </div>
    <div id="back-select-box" style="display: none;height: 2rem;">
        <p>
            <a id="back-select-btn" href="javascript:;" style="float: right;">è¿”å›å¯¼å…¥é€‰é¡¹ â†’</a>
        </p>
    </div>
    <div id="upload-box" style="display: none">
        <div class="row">
            <div class="col-md-4">
                <a href="/dtr/user-file/download">ğŸ‘‰æ¨¡æ¿ä¸‹è½½</a>
            </div>
            <div class="col-md-6">
                <label class="sr-only" for="userFile">æ–‡ä»¶è¾“å…¥</label>
                <input type="file" id="userFile" name="userFile">
            </div>
            <div class="col-md-2">
                <button id="upload-btn" class="btn btn-primary">æäº¤</button>
            </div>
        </div>
        <div class="progress" id="userFile-icons" style="display: none">
            <div class="progress-bar" role="progressbar" aria-valuenow="60"
                 aria-valuemin="0" aria-valuemax="100" style="width: 40%;">
                <span class="sr-only"><span id="upload-down"></span> å®Œæˆ</span>
            </div>
        </div>
    </div>
    <div class="row" id="msg-input-box" style="padding-top: 1.2rem; display: none">
        <div class="col-md-4 text-xl-center ">
            <h5><img src="/images/classTime.png" alt=""> ç”¨æˆ·å§“å</h5>
            <input class="form-control" id="userName" type="text"/>
        </div>
        <div class="col-md-4 text-xl-center ">
            <h5><img src="/images/classTime.png" alt=""> ç”¨æˆ·ç±»åˆ«</h5>
            <select class="form-control" id="userType">
                <option value="å­¦ç”Ÿ">å­¦ç”Ÿ</option>
                <option value="æ•™å¸ˆ">æ•™å¸ˆ</option>
                <option value="å®¶é•¿">å®¶é•¿</option>
            </select>
        </div>
        <div class="col-md-4 text-xl-center classTime">
            <h5><img src="/images/classTime.png" alt=""> ç”¨æˆ·å­¦å·/å·¥å·</h5>
            <input class="form-control" id="userNbr" type="text"/>
        </div>
        <div class="col-md-4 text-xl-center classTime">
            <h5><img src="/images/classTime.png" alt=""> ç”¨æˆ·æ€§åˆ«</h5>
            <input class="form-control" id="userSex" type="text"/>
        </div>
        <div class="col-md-4 text-xl-center classTime">
            <h5><img src="/images/classTime.png" alt=""> ç”¨æˆ·ç”µè¯</h5>
            <input class="form-control" id="userPhone" type="text"/>
        </div>
        <button id="msg-input-btn" class="btn btn-primary">æäº¤</button>
    </div>
</div>
</div>
<!--background-color: #4cd137;-->
<script type="text/html" id="courses-show-box-art">
    {{ if data && data.length>0 }}{{each data}}
    <div class="ibox  border shadow courses-show-box">
        <div class="ibox-title border-bottom">
            <h5>{{$value.name}}</h5>
        </div>
        <div class="ibox-content">
            <h1 class="no-margins"><span class="classNumber">{{$value.value}}</span></h1>
        </div>
    </div>
    {{/each}}{{/if}}
</script>
<script src="/js/jquery-3.1.1.min.js"></script>
<script src="/js/bootstrap/bootstrap-v4.3.1.min.js"></script>
<script src="/js/echarts/echarts.min.js"></script>
<script src="/js/app.js"></script>
<script type="text/javascript">
    var admin = (function () {
        var bindEvents = function () {
            admin.getAdminMsg();
        };
        return {
            data: {},
            el: function (expr) {
                return $(expr ? expr : 'body');
            },
            init: function () {
                bindEvents();
                return;
            },
            show: function () {
                admin.el().show();
                return this;
            },
            hide: function () {
                admin.el().hide();
                return this;
            },
            varMatChart: function (typeData,courseData) {
                // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹
                var myChart = echarts.init(document.getElementById('show-data-content'));
                var myChartoption = {
                    title: {
                        text: 'å‘å¸ƒæƒ…å†µ'
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data: typeData
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series:courseData
                };
                // ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚
                myChart.setOption(myChartoption);
            },
            varMyPieChart: function (data) {
                var myPieChart = echarts.init(document.getElementById('show-pie-chart'));
                option = {
                    series: [{
                        name: 'è¯¾ç¨‹æ¯”ä¾‹',
                        type: 'pie',
                        radius: '55%',
                        // roseType: 'angle',
                        data: data
                    }]
                };
                myPieChart.setOption(option);
            },
            uploadFile: function () {
                var $file = document.getElementById("#userFile");
                var fileVal = admin.el("#userFile").val();//ç”¨æˆ·æ–‡ä»¶å†…å®¹(æ–‡ä»¶)
                // åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸ºç©º
                if (fileVal == "") {
                    App.alert("è¯·é€‰æ‹©ä¸Šä¼ çš„ç›®æ ‡æ–‡ä»¶! ", "", 3, function () {
                        return;
                    });
                    return;
                }
                //åˆ¤æ–­æ–‡ä»¶ç±»å‹,æˆ‘è¿™é‡Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆ¤æ–­çš„æ˜¯Excelæ–‡ä»¶
                var fileName1 = fileVal.substring(fileVal.lastIndexOf(".") + 1).toLowerCase();
                if (fileName1 != "xls" && fileName1 != "xlsx") {
                    App.alert("è¯·é€‰æ‹©Execlæ–‡ä»¶!", "", 3, function () {
                        return;
                    });
                    return;
                }
                //åˆ¤æ–­æ–‡ä»¶å¤§å°
                var size1 = $("#userFile")[0].files[0].size;
                if (size1 > 104857600) {
                    alert("ä¸Šä¼ æ–‡ä»¶ä¸èƒ½å¤§äº100M!");
                    return;
                }
                var formData = new FormData();//è¿™é‡Œéœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªFormDataæ¥è¿›è¡Œæ–‡ä»¶ä¸Šä¼ 
                formData.append("file", $("#userFile")[0].files[0]);
                App.loader();
                $.ajax({
                    type: "post",
                    url: "/dtr/user-file/upload",
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        if (!App.checker(data)) {
                            return;
                        } else {
                            App.alert("æäº¤æˆåŠŸ");
                            return;
                        }
                        App.removeLoader();
                    }
                });
            },
            selectBoxShow: function () {
                admin.el("#input-select-box").show();
                admin.el("#back-select-box").hide();
                admin.el("#upload-box").hide();
                admin.el("#msg-input-box").hide();
            },
            selectBoxHide: function () {
                admin.el("#input-select-box").hide();
                admin.el("#back-select-box").show();
            },
            uploadBoxShow: function () {
                admin.el("#upload-box").show();
                admin.el("#msg-input-box").hide();
            },
            magInputBoxShow: function () {
                admin.el("#upload-box").hide();
                admin.el("#msg-input-box").show();
            },
            panelClick:function () {
                admin.el("#back-select-box").off("click").on("click", function () {
                    admin.selectBoxShow();
                });
                admin.el("#upload-btn").off("click").on("click", function () {
                    admin.uploadFile();
                });
                admin.el("#input-once").off("click").on("click", function () {
                    admin.selectBoxHide();
                    admin.magInputBoxShow();
                });
                admin.el("#input-batch").off("click").on("click", function () {
                    admin.selectBoxHide();
                    admin.uploadBoxShow();
                });
                admin.el("#msg-input-btn").off("click").on("click", function () {
                    var userName = admin.el('#userName').val();
                    var userType = admin.el('#userType').val();
                    var userNbr = admin.el('#userNbr').val();
                    var userSex = admin.el('#userSex').val();
                    var userPhone = admin.el('#userPhone').val();
                    $.loadJSON('/dtr/user/addUser', {
                        userName: userName,
                        userType: userType,
                        userNbr: userNbr,
                        userSex: userSex,
                        userPhone: userPhone
                    }).done(function (data) {
                        if (!App.checker(data)) {
                            return;
                        } else {
                            App.alert("æäº¤æˆåŠŸ", '', 1, function () {
                                admin.inputClear();
                            });
                            return;
                        }
                    });
                });
                admin.el("#admin-loginOut").off("click").on("click", function () {
                    var adminID = admin.el(".adminName").data("adminID");
                    $.loadJSON('/dtr/admin/adminOut', {
                        adminID:adminID
                    }).done(function (data) {
                        if (!App.checker(data)) {
                            return;
                        } else {
                            App.alert("é€€å‡ºæˆåŠŸ", '', 1, function () {App.goAdminLoginBySelf()});
                            return;
                        }
                    });
                });

            },
            getMsgPast:function(){
                $.loadJSON('/dtr/issue/getHistory').done(function (data) {
                    if (!App.checker(data)) {
                        return;
                    } else {
                        var dataPie = data.pastWeek;
                        var typeData = data.typeList;
                        var courseData = data.pastMonth.courseList;
                        console.log(courseData);
                        admin.paddingShowBox(dataPie)
                            .then(function () {admin.varMyPieChart(dataPie);return this;})
                            .then(function () {admin.varMatChart(typeData,courseData);return this;})
                            .then(function () {App.randomBackgroundColor("courses-show-box");return this});
                        admin.varMatChart(typeData,courseData);
                        return;
                    }
                });
            },
            paddingShowBox:function (data) {
                return $.Deferred(function (defer) {
                    admin.el("#courses-show-box-container").html(template('courses-show-box-art', {data: data}));
                    defer.resolve();
                }).promise();
            },
            getAdminMsg:function () {
                return $.Deferred(function (defer) {
                    $.loadJSON('/dtr/admin/getAdmin').done(function (data) {
                        if (!App.checker(data)) {
                            App.alert("ç®¡ç†å‘˜æœªç™»å½•ï¼","",2,function(){
                               App.goAdminLoginBySelf();
                            });
                            return false;
                        } else {
                            var adminName = data.admin.name;
                            var adminID = data.admin.id;
                            admin.el(".adminName").html(adminName);
                            admin.el(".adminName").data("adminID",adminID);
                            admin.getMsgPast();
                            admin.panelClick();
                            return true;
                        }
                    });
                    defer.resolve();
                }).promise();
            }
        }
    })();
    $(function () {
        admin.init();
    });
</script>
</body>

</html>